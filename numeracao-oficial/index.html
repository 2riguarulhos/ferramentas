<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Certidão de Numeração Oficial</title>
  <style>
    body { font-family: Arial; background: #fff; margin: 0; padding: 20px; }
    .box { max-width: 1000px; margin: auto; }
    h1 { color: #6b1d1d; }
    input { width: 100%; height: 40px; padding: 8px; margin: 8px 0; }
    button { height: 40px; padding: 0 16px; cursor: pointer; }
    iframe { width: 100%; height: 600px; border: 1px solid #ddd; margin-top: 12px; }
  </style>
</head>
<body>
  <div class="box">
    <h1>Certidão de Numeração Oficial</h1>

    <label>Inscrição Cadastral</label>
    <input id="inscricao" placeholder="083.63.10.0665.00.000 ou 0836310066500000"/>

    <button onclick="emitir()">Emitir</button>
    <button onclick="limpar()">Limpar</button>

    <p id="status"></p>

    <iframe id="pdfViewer"></iframe>
  </div>

  <script>
    async function emitir(){
      const inscricao = document.getElementById("inscricao").value.trim();
      if(!inscricao){
        document.getElementById("status").innerText = "Preencha a inscrição.";
        return;
      }

      document.getElementById("status").innerText = "Emitindo certidão...";

      const resp = await fetch("http://SEU-IP-DA-VM:5002/api/numeracao-oficial", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({inscricao})
      });

      if(!resp.ok){
        const err = await resp.json().catch(()=>({error:"Erro desconhecido"}));
        document.getElementById("status").innerText = err.error || "Erro ao emitir.";
        return;
      }

      const blob = await resp.blob();
      const url = URL.createObjectURL(blob);

      document.getElementById("pdfViewer").src = url;
      document.getElementById("status").innerText = "Certidão emitida ✅";
    }

    function limpar(){
      document.getElementById("inscricao").value = "";
      document.getElementById("pdfViewer").src = "";
      document.getElementById("status").innerText = "";
    }
  </script>
</body>
</html>

